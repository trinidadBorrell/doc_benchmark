---
# ICM Complete Configuration with Individual Markers
# Replicates ICMReportDataExtractorReviewed using individual junifer markers
# Based on analysis of icm_report_data_extractor_reviewed.py

with:
  - "junifer_eeg"

workdir: "."

datagrabber:
  kind: ICMLGDataGrabber
  patterns:
    EEG:
      pattern: "/data/project/eeg_foundation/data/control/fifdata_256/nice_epochs_lg/sub-001/ses-01/eeg/sub-001_ses-01_task-lg_acq-01_epo.fif"
      space: "native"
  replacements: []
  types:
    - EEG
  datadir: "/data/project/eeg_foundation/src/junifer-for-picnic/"


storage:
  kind: HDF5FeatureStorage
  uri: icm_complete_features.h5
  single_output: true

markers:

  # ========================================
  # 1. SPECTRAL MARKERS (11 total) 
  # ========================================
  
  # Per-channel spectral power (no ROI aggregation, trial averaged)
  - kind: SpectralPower
    name: per_channel_delta
    bands:
      delta: [1.0, 4.0]
    normalize: false
    dB: true
    db_threshold: 1.0e-12
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null  # No ROI aggregation - keep per-channel
    trial_aggregation_method: "trim_mean80"  # Average across trials
    on: EEG

  - kind: SpectralPower
    name: per_channel_theta
    bands:
      theta: [4.0, 8.0]
    normalize: false
    dB: true
    db_threshold: 1.0e-12
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SpectralPower
    name: per_channel_alpha
    bands:
      alpha: [8.0, 12.0]
    normalize: false
    dB: true
    db_threshold: 1.0e-12
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SpectralPower
    name: per_channel_beta
    bands:
      beta: [12.0, 30.0]
    normalize: false
    dB: true
    db_threshold: 1.0e-12
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SpectralPower
    name: per_channel_gamma
    bands:
      gamma: [30.0, 45.0]
    normalize: false
    dB: true
    db_threshold: 1.0e-12
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SpectralPower
    name: deltan_spectralpower
    fmin: 1.0
    fmax: 4.0
    normalize: true
    dB: false
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SpectralPower
    name: thetan_spectralpower
    fmin: 4.0
    fmax: 8.0
    normalize: true
    dB: false
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SpectralPower
    name: alphan_spectralpower
    fmin: 8.0
    fmax: 12.0
    normalize: true
    dB: false
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SpectralPower
    name: betan_spectralpower
    fmin: 12.0
    fmax: 30.0
    normalize: true
    dB: false
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SpectralPower
    name: gamman_spectralpower
    fmin: 30.0
    fmax: 45.0
    normalize: true
    dB: false
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SpectralPower
    name: summary_se_spectralpower
    fmin: 1.0
    fmax: 45.0
    normalize: true
    dB: false
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  # ========================================
  # PSD SUMMARY MARKERS (3 total: #12-14)
  # ========================================
  # Per-channel spectral summaries
  - kind: PowerSpectralDensitySummary
    name: per_channel_msf
    percentile: 0.5
    tmin: null
    tmax: 0.6
    fmin: 1.0
    fmax: 45.0
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null  # No ROI aggregation
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: PowerSpectralDensitySummary
    name: per_channel_sef90
    percentile: 0.9
    tmin: null
    tmax: 0.6
    fmin: 1.0
    fmax: 45.0
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: PowerSpectralDensitySummary
    name: per_channel_sef95
    percentile: 0.95
    tmin: null
    tmax: 0.6
    fmin: 1.0
    fmax: 45.0
    n_fft: 4096
    n_overlap: 100
    n_per_seg: 128
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  # ========================================
  # PERMUTATION ENTROPY (4 total: #15-18)
  # ========================================

  - kind: PermutationEntropy
    name: pe_theta
    tmin: null
    tmax: 0.6
    tau: 8
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: PermutationEntropy
    name: pe_alpha
    tmin: null
    tmax: 0.6
    tau: 4
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: PermutationEntropy
    name: pe_beta
    tmin: null
    tmax: 0.6
    tau: 2
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: PermutationEntropy
    name: pe_gamma
    tmin: null
    tmax: 0.6
    tau: 1
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG



  # ========================================
  # SYMBOLIC MUTUAL INFORMATION (4 total: #19-22)
  # ========================================

  - kind: SymbolicMutualInformation
    name: wsmi_theta
    tmin: null
    tmax: 0.6
    kernel: 3
    tau: 8
    weighted: true
    csd: true
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SymbolicMutualInformation
    name: wsmi_alpha
    tmin: null
    tmax: 0.6
    kernel: 3
    tau: 4
    weighted: true
    csd: true
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SymbolicMutualInformation
    name: wsmi_beta
    tmin: null
    tmax: 0.6
    kernel: 3
    tau: 2
    weighted: true
    csd: true
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  - kind: SymbolicMutualInformation
    name: wsmi_gamma
    tmin: null
    tmax: 0.6
    kernel: 3
    tau: 1
    weighted: true
    csd: true
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

  # ========================================
  # KOLMOGOROV COMPLEXITY (1 total: #23)
  # ========================================

  # Kolmogorov Complexity (broadband)
  - kind: KolmogorovComplexity
    name: kolmogorov_complexity
    tmin: null
    tmax: 0.6  # ICM standard
    nbins: 32
    channel_aggregation_method: null
    trial_aggregation_method: "trim_mean80"
    on: EEG

